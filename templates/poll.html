{% extends "base.html" %}
{% block content %}
<h2>Kysely: {{ poll.name }}</h2>
<p>Kuvaus: {{ poll.description }}</h2>
<p>Kyselyn päättymisaika: {{ poll.end }}</p>

{% if participant_times|length > 0 %}
    <h2>Varaustoiveet</h2>
    <p>Lisää uusi toive. Uusi toive ylikirjoittaa
    vanhat alle jäävät toiveet.</p>
    <p>Varattavan ajan pituus: {{ participant_times[0][2] }}</p>
    <p>0 = Ei sovi, 1 = Sopii tarvittaessa, 2 = Sopii hyvin</p>
    <h3>Esimerkki:</h3>
    <p>Jos aikatoiveenasi on väli [10:00 - 11:00) "Sopii hyvin" ja muut ajat
    "Ei sovi", niin 30 min aika voi silloin alkaa milloin tahansa välillä
    [10:00, 10:30)</p>

    {% for day in participant_times[0][0] %}
        <h3>{{ day.date }}</h3>
        {% for interval in day.intervals %}
        <p>{{ interval[0] }}&ndash;{{ interval[1]}}: {{ interval[2] }}</p>
        {% endfor %}
        <form action="/new_time_preference" method="post">
            <label for=2>Sopii hyvin:</label>
            <input type="radio" name="satisfaction" id=2 value=2 checked>
            <label for=1>Sopii tarvittaessa:</label>
            <input type="radio" name="satisfaction" id=1 value=1>
            <label for=0>Ei sovi:</label>
            <input type="radio" name="satisfaction" id=0 value=0>
            <br>
            <label for="start">Aikavälin alku:</label>
            <input type="time" name="start" id="start" step="300">
            <label for="start">Aikavälin loppu:</label>
            <input type="time" name="end" id="end" step="300">
            <br>
            <input type="submit" value="Lisää toive">
            <input type="hidden" name="date" value={{ day.date }}>
            <input type="hidden" name="member_id" 
                   value={{ participant_times[0][1] }}>
            <input type="hidden" name="poll_id" value={{ poll.poll_id }}>
        </form>
    {% endfor %}
{% endif %}
{% if resource_times|length > 0 %}
    <h2>Resurssien tarjontatoiveet</h2>
    <p>0 = Ei sovi, 1 = Sopii</p>
    {% for resource in resource_times %}
        <h3>Muokkaa aikoja resurssissa {{ resource[2] }}</h3>
        {% for day in resource[0] %}
            <h3>{{ day.date }}</h3>
            {% for interval in day.intervals %}
            <p>{{ interval[0] }}&ndash;{{ interval[1]}}: {{ interval[2] }}</p>
            {% endfor %}
            <form action="/new_time_preference" method="post">
                <label for=1>Sopii:</label>
                <input type="radio" name="satisfaction" id=1 value=1 checked>
                <label for=0>Ei sovi:</label>
                <input type="radio" name="satisfaction" id=0 value=0>
                <br>
                <label for="start">Aikavälin alku:</label>
                <input type="time" name="start" id="start" step=300>
                <label for="start">Aikavälin loppu:</label>
                <input type="time" name="end" id="end" step=300>
                <br>
                <input type="submit" value="Lisää toive">
                <input type="hidden" name="date" value={{ day.date }}>
                <input type="hidden" name="member_id"
                       value={{ resource[1] }}>
                <input type="hidden" name="poll_id" value={{ poll.poll_id }}>
            </form>
        {% endfor %}
    {% endfor %}
{% endif %}
{% if is_owner %}
<h2>Aktiiviset vastaajakutsumislinkit:</h2>
<ul>
<table>
<tr><th>Url</th><th>Varauksen pituus</th></tr>
{% for invitation in participant_invitations %}
<tr><td>/invite/{{ invitation[0] }}</td><td>{{ invitation[1] }}</td></tr>
{% endfor %}
</table>

<form action="/new_invitation" method="post">
<h2>Luo uusi vastaajienkutsumislinkki</h2>
<ul>
    <label for="reservation_length">Varauksen pituus minuutteina (5 min tarkkuus)</label>
    <input type="number" min=5 value=60 step=5 name="reservation_length" 
           id="reservation_length">
    <input type="submit" value="Luo linkki">
    <input type="hidden" name="poll_id" value={{ poll.poll_id }}>
    <input type="hidden" name="invitation_type" value="poll_customer">
</ul>
</form>

<h2>Luo uusi resurssi:</h2>
<form action="/new_resource" method="post">
    <label for="resource_name">Resurssin nimi:</label>
    <input type="text" name="resource_name" id="resource_name">
    <input type="submit" value="Luo resurssi">
    <input type="hidden" name="poll_id" value={{ poll.poll_id }}>
</form>

<h2>Aktiiviset resurssit:</h2>
<table>
<tr>
    <th>Resurssin id</th><th>Resurssin kuvaus</th>
<tr>
{% for resource in resources %}
<tr>
    <td>{{ resource[1] }}</td>
    <td>{{ resource[0] }}</td>

</tr>
{% endfor %}
</table>
<h2>Aktiiviset resurssikutsulinkit</h2>
<table>
<tr><th>Url</th><th>Resurssin kuvaus</th></tr>
{% for invitation in resource_invitations %}
<tr><td>/invite/{{ invitation[0] }}</td><td>{{ invitation[1] }}</td></tr>
{% endfor %}
</table>


{% if resources|length > 0 %}
<h2>Luo uusi resurssikutsu</h2>
<form action="/new_invitation" method="post">
    {% for resource in resources %}
    <label for={{ resource[1] }}>{{ resource[0] }}</label>
    <input type="radio" name="member_id" id={{ resource[1] }}
           value={{ resource[1] }}>
    {% endfor %}
    <br>
    <input type="submit" value="Luo linkki">
    <input type="hidden" name="invitation_type" value="resource_owner">
    <input type="hidden" name="poll_id" value={{ poll.poll_id }}>

</form>
{% endif %}
<h2>Optimointi</h2>
<form action="/optimize_poll" method="post">
    <input type="submit" value="Optimoi ajanvaraukset">
    <input type="hidden" name="poll_id" value={{ poll.poll_id }}>
</form>
<h2>Optimoinnin tulokset:</h2>
{% if optimization_results|length > 0 %}
<table>
    <tr><th>Käyttäjänimi</th><th>Resurssin kuvaus</th><th>Aika</th></tr>
{% for result in optimization_results %}
    <tr>
        <td>{{ result.username }}</td><td>{{ result.resource_name }}</td>
        <td>{{ result.time }}</td>
    </tr>
{% endfor %}
</table>
{% else %}
<p>Ei tuloksia tai optimointia ei ole suoritettu</p>
{% endif %}
{% endif %}
{% endblock %}
